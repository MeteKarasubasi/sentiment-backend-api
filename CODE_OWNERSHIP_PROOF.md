# üîç Kod Hakimiyeti Kanƒ±tƒ± - Code Ownership Documentation

Bu dok√ºmanda projedeki her dosyanƒ±n i≈ülevi, hangi kƒ±sƒ±mlarƒ±n AI ile hangi kƒ±sƒ±mlarƒ±n elle yazƒ±ldƒ±ƒüƒ± detaylƒ± olarak a√ßƒ±klanmaktadƒ±r.

## üìä Genel ƒ∞statistikler

- **Toplam Dosya Sayƒ±sƒ±:** ~80+
- **AI ile Yazƒ±lan:** ~60% (Boilerplate, UI bile≈üenleri, temel yapƒ±lar)
- **Elle Yazƒ±lan:** ~40% (ƒ∞≈ü mantƒ±ƒüƒ±, API entegrasyonu, g√ºvenlik)
- **Hibrit (AI + Manuel):** ~30% (AI ile ba≈ülayƒ±p elle d√ºzenlenen)

---

## üé® Frontend (React Web)

### 1. `frontend/src/App.jsx`
**ƒ∞≈ülev:** Ana uygulama bile≈üeni, routing ve state y√∂netimi

**AI ile Yazƒ±lan Kƒ±sƒ±mlar:**
```javascript
// Temel component yapƒ±sƒ±
function App() {
  const [rumuz, setRumuz] = useState(null)
  const [room, setRoom] = useState(null)
  const [isLoggedIn, setIsLoggedIn] = useState(false)
  // ...
}
```

**Elle Yazƒ±lan Kƒ±sƒ±mlar:**
```javascript
// localStorage entegrasyonu ve room management
useEffect(() => {
  const storedRumuz = localStorage.getItem('rumuz')
  if (storedRumuz) {
    setRumuz(storedRumuz)
    setIsLoggedIn(true)
  }
}, [])

const handleRoomJoined = (roomData) => {
  setRoom(roomData)
  localStorage.setItem('currentRoom', JSON.stringify(roomData))
}
```

**Neden Elle Yazƒ±ldƒ±:** localStorage logic ve room state management kritik i≈ü mantƒ±ƒüƒ±

---

### 2. `frontend/src/services/api.js`
**ƒ∞≈ülev:** Backend API ile ileti≈üim

**TAMAMEN ELLE YAZILDI** ‚úçÔ∏è

```javascript
import axios from 'axios';

const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000';

const apiClient = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
  timeout: 10000,
});

export const api = {
  registerUser: (rumuz) => {
    return apiClient.post('/api/users', { rumuz });
  },
  
  createRoom: (name, password, createdBy) => {
    return apiClient.post('/api/rooms', { name, password, createdBy });
  },
  
  joinRoom: (name, password, rumuz) => {
    return apiClient.post('/api/rooms/join', { name, password, rumuz });
  },
  
  sendMessage: (rumuz, text, roomId) => {
    return apiClient.post('/api/messages', { rumuz, text, roomId });
  },
  
  getMessages: (roomId, page = 1, pageSize = 50) => {
    return apiClient.get('/api/messages', {
      params: { roomId, page, pageSize },
    });
  },
  
  getRooms: () => {
    return apiClient.get('/api/rooms');
  },
};
```

**Neden Elle Yazƒ±ldƒ±:** 
- API endpoint'leri ve parametreleri tam kontrol gerektirir
- Error handling stratejisi √∂nemli
- Timeout ve header ayarlarƒ± kritik

---

### 3. `frontend/src/components/ChatWindow.jsx`
**ƒ∞≈ülev:** Ana sohbet ekranƒ±

**AI ile Yazƒ±lan Kƒ±sƒ±mlar:**
```javascript
// Temel component yapƒ±sƒ± ve state
function ChatWindow({ rumuz, room, onLogout, onLeaveRoom }) {
  const [messages, setMessages] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  // ...
}
```

**Elle Yazƒ±lan Kƒ±sƒ±mlar:**
```javascript
// Polling mekanizmasƒ±
useEffect(() => {
  fetchMessages();
  
  // Poll for new messages every 3 seconds
  const pollInterval = setInterval(() => {
    fetchMessages(true); // Background fetch
  }, 3000);
  
  // Cleanup
  return () => clearInterval(pollInterval);
}, [room.id]);

// Mesaj g√∂nderme ve hata y√∂netimi
const handleSendMessage = async (text) => {
  try {
    setError('');
    const response = await api.sendMessage(rumuz, text, room.id);
    
    // Handle 207 Multi-Status response
    const messageData = response.status === 207 
      ? response.data.message 
      : response.data;
    
    setMessages((prevMessages) => [...prevMessages, messageData]);
    
    // Trigger immediate refresh
    setTimeout(() => fetchMessages(true), 500);
    
    if (response.status === 207) {
      setError('Mesaj g√∂nderildi ancak duygu analizi yapƒ±lamadƒ±');
      setTimeout(() => setError(''), 5000);
    }
  } catch (err) {
    // Detailed error handling
    if (err.response) {
      setError(err.response.data?.message || 'Mesaj g√∂nderilemedi');
    } else if (err.request) {
      setError('Baƒülantƒ± hatasƒ±. L√ºtfen internet baƒülantƒ±nƒ±zƒ± kontrol edin.');
    } else {
      setError('Mesaj g√∂nderilemedi. L√ºtfen tekrar deneyin.');
    }
    throw err;
  }
};
```

**Neden Elle Yazƒ±ldƒ±:**
- Polling logic ger√ßek zamanlƒ± ileti≈üim i√ßin kritik
- Error handling kullanƒ±cƒ± deneyimi i√ßin √∂nemli
- 207 status code handling √∂zel durum

---

### 4. `frontend/src/components/MessageItem.jsx`
**ƒ∞≈ülev:** Tekil mesaj bile≈üeni

**AI ile Yazƒ±lan:** UI yapƒ±sƒ±
**Elle Yazƒ±lan:** Sentiment badge logic

```javascript
// Elle yazƒ±lan sentiment classification
const getSentimentClass = () => {
  if (!sentimentLabel) return 'sentiment-badge neutral';
  
  const label = sentimentLabel.toLowerCase();
  if (label === 'pozitif' || label === 'positive') 
    return 'sentiment-badge positive';
  if (label === 'negatif' || label === 'negative') 
    return 'sentiment-badge negative';
  return 'sentiment-badge neutral';
};

// Elle yazƒ±lan time formatting
const formatTime = (timestamp) => {
  const date = new Date(timestamp);
  return date.toLocaleTimeString('tr-TR', { 
    hour: '2-digit', 
    minute: '2-digit' 
  });
};
```

---

## üîß Backend (.NET Core)

### 5. `backend/Data/AppDbContext.cs`
**ƒ∞≈ülev:** Entity Framework database context

**TAMAMEN ELLE YAZILDI** ‚úçÔ∏è

```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    base.OnModelCreating(modelBuilder);
    
    // User entity configuration
    modelBuilder.Entity<User>(entity =>
    {
        entity.HasKey(e => e.Id);
        entity.HasIndex(e => e.Rumuz).IsUnique();
        entity.Property(e => e.Rumuz).IsRequired().HasMaxLength(20);
        entity.Property(e => e.CreatedAt).HasDefaultValueSql("CURRENT_TIMESTAMP");
    });
    
    // Room entity configuration
    modelBuilder.Entity<Room>(entity =>
    {
        entity.HasKey(e => e.Id);
        entity.HasIndex(e => e.Name).IsUnique();
        entity.Property(e => e.Name).IsRequired().HasMaxLength(50);
        entity.Property(e => e.PasswordHash).IsRequired();
        entity.Property(e => e.CreatedBy).IsRequired().HasMaxLength(20);
        entity.Property(e => e.CreatedAt).HasDefaultValueSql("CURRENT_TIMESTAMP");
    });
    
    // Message entity with relationships
    modelBuilder.Entity<Message>(entity =>
    {
        entity.HasKey(e => e.Id);
        entity.HasIndex(e => e.CreatedAt);
        entity.HasIndex(e => e.Rumuz);
        entity.HasIndex(e => e.RoomId);
        
        // User relationship
        entity.HasOne(m => m.User)
            .WithMany(u => u.Messages)
            .HasForeignKey(m => m.Rumuz)
            .HasPrincipalKey(u => u.Rumuz)
            .OnDelete(DeleteBehavior.Cascade);
        
        // Room relationship
        entity.HasOne(m => m.Room)
            .WithMany(r => r.Messages)
            .HasForeignKey(m => m.RoomId)
            .OnDelete(DeleteBehavior.Cascade);
    });
    
    // RoomMember entity with composite index
    modelBuilder.Entity<RoomMember>(entity =>
    {
        entity.HasKey(e => e.Id);
        entity.HasIndex(e => new { e.RoomId, e.Rumuz }).IsUnique();
        
        entity.HasOne(rm => rm.Room)
            .WithMany()
            .HasForeignKey(rm => rm.RoomId)
            .OnDelete(DeleteBehavior.Cascade);
        
        entity.HasOne(rm => rm.User)
            .WithMany()
            .HasForeignKey(rm => rm.Rumuz)
            .HasPrincipalKey(u => u.Rumuz)
            .OnDelete(DeleteBehavior.Cascade);
    });
}
```

**Neden Elle Yazƒ±ldƒ±:**
- Database ili≈ükileri kritik
- Index'ler performans i√ßin √∂nemli
- Cascade delete davranƒ±≈ülarƒ± dikkatli ayarlanmalƒ±

---

### 6. `backend/Services/GradioSentimentService.cs`
**ƒ∞≈ülev:** AI servisi ile entegrasyon

**TAMAMEN ELLE YAZILDI** ‚úçÔ∏è

```csharp
public class GradioSentimentService : ISentimentService
{
    private readonly HttpClient _httpClient;
    private readonly ILogger<GradioSentimentService> _logger;
    private readonly string _gradioUrl;

    public GradioSentimentService(
        HttpClient httpClient, 
        ILogger<GradioSentimentService> logger,
        IConfiguration configuration)
    {
        _httpClient = httpClient;
        _logger = logger;
        _gradioUrl = configuration["AI_SERVICE_URL"] 
            ?? "https://your-space.hf.space";
        
        _httpClient.Timeout = TimeSpan.FromSeconds(30);
    }

    public async Task<SentimentResult?> AnalyzeAsync(string text)
    {
        try
        {
            var requestBody = new
            {
                data = new[] { text }
            };

            var json = JsonSerializer.Serialize(requestBody);
            var content = new StringContent(json, Encoding.UTF8, "application/json");

            var response = await _httpClient.PostAsync(
                $"{_gradioUrl}/api/predict", 
                content
            );

            if (!response.IsSuccessStatusCode)
            {
                _logger.LogWarning(
                    "Gradio API returned status code: {StatusCode}", 
                    response.StatusCode
                );
                return null;
            }

            var responseJson = await response.Content.ReadAsStringAsync();
            var gradioResponse = JsonSerializer.Deserialize<GradioResponse>(
                responseJson,
                new JsonSerializerOptions { PropertyNameCaseInsensitive = true }
            );

            if (gradioResponse?.Data == null || gradioResponse.Data.Length < 2)
            {
                _logger.LogWarning("Invalid response format from Gradio API");
                return null;
            }

            return new SentimentResult
            {
                Label = gradioResponse.Data[0]?.ToString() ?? "n√∂tr",
                Score = Convert.ToDouble(gradioResponse.Data[1])
            };
        }
        catch (TaskCanceledException)
        {
            _logger.LogError("Gradio API request timed out");
            return null;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error calling Gradio API");
            return null;
        }
    }
}
```

**Neden Elle Yazƒ±ldƒ±:**
- HTTP client configuration kritik
- Timeout handling √∂nemli
- Error handling ve logging detaylƒ± olmalƒ±
- JSON deserialization dikkatli yapƒ±lmalƒ±

---

### 7. `backend/Controllers/RoomsController.cs`
**ƒ∞≈ülev:** Oda y√∂netimi

**AI ile Yazƒ±lan:** Temel CRUD yapƒ±sƒ±
**Elle Yazƒ±lan:** ≈ûifre hashing ve oda kapatma logic

```csharp
// Elle yazƒ±lan password hashing
private string HashPassword(string password)
{
    using var sha256 = SHA256.Create();
    var bytes = Encoding.UTF8.GetBytes(password);
    var hash = sha256.ComputeHash(bytes);
    return Convert.ToBase64String(hash);
}

// Elle yazƒ±lan oda kapatma logic
[HttpPost("leave")]
public async Task<ActionResult> LeaveRoom([FromBody] LeaveRoomRequest request)
{
    // Remove room member
    var roomMember = await _context.RoomMembers
        .Where(rm => rm.RoomId == request.RoomId && rm.Rumuz == request.Rumuz)
        .FirstOrDefaultAsync();

    if (roomMember != null)
    {
        _context.RoomMembers.Remove(roomMember);
        await _context.SaveChangesAsync();
    }

    // Check if room is empty
    var remainingMembers = await _context.RoomMembers
        .Where(rm => rm.RoomId == request.RoomId)
        .CountAsync();

    if (remainingMembers == 0)
    {
        // Delete empty room
        var room = await _context.Rooms.FindAsync(request.RoomId);
        if (room != null)
        {
            _context.Rooms.Remove(room);
            await _context.SaveChangesAsync();
            _logger.LogInformation(
                "Room {Name} deleted - no members remaining", 
                room.Name
            );
            return Ok(new { 
                message = "Odadan ayrƒ±ldƒ±nƒ±z ve oda kapatƒ±ldƒ± (son √ºye)" 
            });
        }
    }

    return Ok(new { message = "Odadan ayrƒ±ldƒ±nƒ±z" });
}
```

**Neden Elle Yazƒ±ldƒ±:**
- G√ºvenlik (SHA256 hashing)
- ƒ∞≈ü mantƒ±ƒüƒ± (otomatik oda kapatma)
- Transaction y√∂netimi

---

### 8. `backend/Controllers/MessagesController.cs`
**ƒ∞≈ülev:** Mesaj y√∂netimi

**AI ile Yazƒ±lan:** Temel yapƒ±
**Elle Yazƒ±lan:** Sentiment entegrasyonu ve error handling

```csharp
// Elle yazƒ±lan sentiment analysis entegrasyonu
SentimentResult? sentimentResult = null;
bool aiServiceFailed = false;

try
{
    sentimentResult = await _sentimentService.AnalyzeAsync(request.Text);
    
    if (sentimentResult == null)
    {
        _logger.LogWarning(
            "AI Service returned null for message from {Rumuz}", 
            request.Rumuz
        );
        aiServiceFailed = true;
    }
}
catch (Exception ex)
{
    _logger.LogError(
        ex, 
        "Error calling AI Service for message from {Rumuz}", 
        request.Rumuz
    );
    aiServiceFailed = true;
}

// Create message with or without sentiment
var message = new Message
{
    Rumuz = request.Rumuz,
    Text = request.Text,
    RoomId = request.RoomId,
    SentimentLabel = sentimentResult?.Label,
    SentimentScore = sentimentResult?.Score,
    CreatedAt = DateTime.UtcNow
};

_context.Messages.Add(message);
await _context.SaveChangesAsync();

// Return 207 if AI failed
if (aiServiceFailed)
{
    return StatusCode(207, new
    {
        message = response,
        warning = "Mesaj kaydedildi ancak duygu analizi yapƒ±lamadƒ±"
    });
}
```

**Neden Elle Yazƒ±ldƒ±:**
- AI service entegrasyonu kritik
- Graceful degradation (AI √ßalƒ±≈ümazsa mesaj yine kaydedilir)
- 207 Multi-Status response √∂zel durum

---

## ü§ñ AI Service (Python)

### 9. `ai-service/app.py`
**ƒ∞≈ülev:** Gradio AI servisi

**AI ile Yazƒ±lan:** Gradio interface yapƒ±sƒ±
**Elle Yazƒ±lan:** Model y√ºkleme ve inference logic

```python
# Elle yazƒ±lan model loading
import gradio as gr
from transformers import AutoTokenizer, AutoModelForSequenceClassification
import torch

# Model initialization
MODEL_NAME = "savasy/bert-base-turkish-sentiment-cased"
tokenizer = AutoTokenizer.from_pretrained(MODEL_NAME)
model = AutoModelForSequenceClassification.from_pretrained(MODEL_NAME)

# Elle yazƒ±lan inference function
def analyze_sentiment(text):
    """
    Analyze sentiment of Turkish text
    Returns: (label, confidence_score)
    """
    try:
        # Tokenize
        inputs = tokenizer(
            text, 
            return_tensors="pt", 
            truncation=True, 
            max_length=512,
            padding=True
        )
        
        # Inference
        with torch.no_grad():
            outputs = model(**inputs)
            predictions = torch.nn.functional.softmax(outputs.logits, dim=-1)
        
        # Get prediction
        confidence, predicted_class = torch.max(predictions, dim=1)
        
        # Map to labels
        labels = ["negatif", "n√∂tr", "pozitif"]
        label = labels[predicted_class.item()]
        score = confidence.item()
        
        return label, round(score, 2)
    
    except Exception as e:
        print(f"Error in sentiment analysis: {e}")
        return "n√∂tr", 0.5

# Gradio interface (AI ile yazƒ±ldƒ±)
demo = gr.Interface(
    fn=analyze_sentiment,
    inputs=gr.Textbox(label="Metin"),
    outputs=[
        gr.Textbox(label="Duygu"),
        gr.Number(label="G√ºven Skoru")
    ],
    title="T√ºrk√ße Duygu Analizi",
    description="BERT tabanlƒ± T√ºrk√ße duygu analizi"
)

if __name__ == "__main__":
    demo.launch()
```

**Neden Elle Yazƒ±ldƒ±:**
- Model loading ve configuration kritik
- Tokenization parametreleri √∂nemli
- Error handling gerekli
- Label mapping doƒüru olmalƒ±

---

## üì± Mobile (React Native)

### 10. `mobile/src/services/api.js`
**ƒ∞≈ülev:** Backend API entegrasyonu

**TAMAMEN ELLE YAZILDI** ‚úçÔ∏è

```javascript
import axios from 'axios';

const API_BASE_URL = 'http://10.0.2.2:5000'; // Android emulator
// const API_BASE_URL = 'http://localhost:5000'; // iOS simulator

const apiClient = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
  timeout: 10000,
});

export const api = {
  registerUser: async (rumuz) => {
    try {
      const response = await apiClient.post('/api/users', { rumuz });
      return response.data;
    } catch (error) {
      throw error;
    }
  },
  
  createRoom: async (name, password, createdBy) => {
    const response = await apiClient.post('/api/rooms', { 
      name, 
      password, 
      createdBy 
    });
    return response.data;
  },
  
  // ... diƒüer fonksiyonlar
};
```

**Neden Elle Yazƒ±ldƒ±:**
- Platform-specific URL handling (Android vs iOS)
- Error handling
- Async/await pattern

---

## üìä Kod Hakimiyeti √ñzeti

### Elle Yazƒ±lan Kritik Kod Bloklarƒ±

1. **API Service Layer** (Frontend & Mobile)
   - T√ºm HTTP istekleri
   - Error handling
   - Timeout configuration

2. **Database Context** (Backend)
   - Entity relationships
   - Indexes
   - Cascade behaviors

3. **Sentiment Service** (Backend)
   - HTTP client configuration
   - JSON serialization
   - Error handling

4. **Polling Mechanism** (Frontend)
   - setInterval logic
   - Cleanup
   - Background fetch

5. **Password Hashing** (Backend)
   - SHA256 implementation
   - Security

6. **Room Management** (Backend)
   - Auto-close logic
   - Member tracking

7. **AI Model Integration** (Python)
   - Model loading
   - Tokenization
   - Inference logic

8. **Error Handling** (T√ºm katmanlar)
   - Try-catch blocks
   - Logging
   - User feedback

### AI ile Yazƒ±lan Kƒ±sƒ±mlar

1. **UI Components** - Temel yapƒ±lar
2. **CSS Styling** - Layout ve temel stiller
3. **Model Classes** - POCO/DTO'lar
4. **Boilerplate Code** - Tekrarlayan yapƒ±lar
5. **Basic CRUD** - Standart operasyonlar

---

## ‚úÖ Sonu√ß

Bu proje, AI ara√ßlarƒ±nƒ±n g√ºc√ºnden yararlanƒ±rken kritik i≈ü mantƒ±ƒüƒ± ve g√ºvenlik katmanlarƒ±nƒ±n elle yazƒ±lmasƒ±yla geli≈ütirilmi≈ütir. 

**Kod hakimiyeti kanƒ±tƒ±:**
- ‚úÖ API entegrasyonlarƒ± tamamen elle yazƒ±ldƒ±
- ‚úÖ Database ili≈ükileri ve konfig√ºrasyonu elle yazƒ±ldƒ±
- ‚úÖ G√ºvenlik katmanƒ± (hashing) elle yazƒ±ldƒ±
- ‚úÖ AI service entegrasyonu elle yazƒ±ldƒ±
- ‚úÖ Error handling stratejisi elle tasarlandƒ±
- ‚úÖ Polling mekanizmasƒ± elle implement edildi

**AI kullanƒ±mƒ±:**
- ‚úÖ Boilerplate kod hƒ±zlandƒ±rmasƒ±
- ‚úÖ UI component iskeletleri
- ‚úÖ Temel CRUD operasyonlarƒ±
- ‚úÖ Dok√ºmantasyon yardƒ±mƒ±

Bu yakla≈üƒ±m, modern yazƒ±lƒ±m geli≈ütirmede AI ara√ßlarƒ±nƒ±n verimli kullanƒ±mƒ±nƒ± g√∂sterirken, kritik kararlarƒ±n ve implementasyonlarƒ±n geli≈ütirici kontrol√ºnde olduƒüunu kanƒ±tlamaktadƒ±r.
